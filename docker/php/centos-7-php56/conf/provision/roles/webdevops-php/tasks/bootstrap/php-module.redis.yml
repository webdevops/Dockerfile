---
- name: Set php redis file [RedHat family]
  set_fact:
     php_redis_conf: /etc/php.d/redis.ini
  when: ansible_os_family == 'RedHat'

- name: Set php redis file [Debian family]
  set_fact:
     php_redis_conf: /etc/php5/mods-available/redis.ini
  when: ansible_os_family == 'Debian'

- name: Set php redis file [Ubuntu 12.04]
  set_fact:
     php_redis_conf: /etc/php5/conf.d/redis.ini
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_version == "12.04"

- name: Set php redis file [Alpine family]
  set_fact:
     php_redis_conf: /etc/php/conf.d/redis.ini
  when: ansible_distribution == 'Alpine'

- stat: path={{ php_redis_conf }}
  register: st_php_redis_conf
  no_log: True

- name: Enable redis
  copy:
    content: |
      extension=redis.so
    dest: "{{ php_redis_conf }}"
  when: st_php_redis_conf.stat.exists == False
